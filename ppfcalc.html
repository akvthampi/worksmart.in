
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced PPF Calculator</title>
    <style>
        /* Reset and base styles matching index.html */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        html, body { 
            height: 100%; 
            width: 100%; 
            background: #0d1525; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            color: #e0e0e0; 
            line-height: 1.6;
        }
        
        body { 
            min-height: 100vh; 
            padding: 20px 19px; /* 19px ≈ 0.2 inches */
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            color: #e0e0e0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 600;
            padding-left: 18px;
            letter-spacing: 1px;
            border-left: 4px solid #4d7cff;
            text-align: left;
            margin-left: 0;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            color: #a0a8c0;
            text-align: left;
            margin-left: 0;
            margin-top: 10px;
        }
        
        .calculator-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-top: 20px;
        }
        
        .input-section, .result-section {
            flex: 1;
            min-width: 300px;
            background: #1a243d;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid #2a3450;
        }
        
        .section-title {
            color: #e0e0e0;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4d7cff;
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #d0d8e8;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            background: #0d1525;
            border: 1px solid #2a3450;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            color: #e0e0e0;
        }
        
        input:focus, select:focus {
            border-color: #4d7cff;
            outline: none;
            box-shadow: 0 0 0 2px rgba(77, 124, 255, 0.3);
        }
        
        .range-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .range-value {
            min-width: 60px;
            padding: 8px 12px;
            background: #4d7cff;
            color: white;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        
        input[type="range"] {
            background: transparent;
            height: 6px;
            border-radius: 3px;
            -webkit-appearance: none;
            width: 100%;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-runnable-track {
            height: 6px;
            border-radius: 3px;
            background: #2a3450;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4d7cff;
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 0 2px 0 #555;
            transition: background .15s ease-in-out;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            background: #5d8cff;
        }
        
        /* Custom range track with light green fill */
        .range-track {
            position: relative;
            width: 100%;
            height: 6px;
            background: #2a3450;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .range-fill {
            position: absolute;
            height: 100%;
            background: #4CAF50;
            border-radius: 3px;
        }
        
        .custom-range {
            position: absolute;
            width: 100%;
            height: 6px;
            opacity: 0;
            cursor: pointer;
        }
        
        button {
            background: #4d7cff;
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(77, 124, 255, 0.3);
            background: #5d8cff;
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #2a3450;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: #d0d8e8;
        }
        
        .result-value {
            font-weight: 700;
            font-size: 1.1em;
        }
        
        .total-interest {
            color: #4CAF50;
        }
        
        .total-deposit {
            color: #4d7cff;
        }
        
        .maturity-value {
            color: #FF9800;
            font-size: 1.3em;
        }
        
        .chart-container {
            margin-top: 30px;
            height: 300px;
            position: relative;
            background: white;
            border-radius: 8px;
            padding: 0;
            border: 1px solid #2a3450;
            overflow: hidden;
        }
        
        .rules-section {
            background: #1a243d;
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid #2a3450;
        }
        
        .rules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .rule-card {
            background: #0d1525;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #4d7cff;
        }
        
        .rule-title {
            font-weight: 700;
            color: #4d7cff;
            margin-bottom: 10px;
        }
        
        footer {
            text-align: center;
            color: #a0a8c0;
            padding: 30px 0;
            margin-top: 30px;
            font-size: 0.9rem;
        }
        
        .hidden {
            display: none;
        }
        
        .extension-section {
            background: #0d1525;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #2a3450;
        }
        
        .extension-section h3 {
            color: #4d7cff;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }
        
        @media (max-width: 768px) {
            .calculator-container {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
                text-align: center;
                padding-left: 0;
                border-left: none;
                border-bottom: 3px solid #4d7cff;
                padding-bottom: 10px;
                margin-left: 0;
                margin-right: 0;
            }
            
            .subtitle {
                text-align: center;
                margin-left: 0;
                margin-right: 0;
            }
            
            .input-section, .result-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Advanced Public Provident Fund (PPF) Calculator</h1>
            <p class="subtitle">Calculate your PPF returns with precision including extensions</p>
        </header>
        
        <div class="calculator-container">
            <div class="input-section">
                <h2 class="section-title">Investment Details</h2>
                
                <div class="form-group">
                    <label for="investment-type">Investment Type</label>
                    <select id="investment-type">
                        <option value="annual">Annual Investment</option>
                        <option value="monthly">Monthly Investment</option>
                    </select>
                </div>
                
                <div class="form-group" id="annual-investment-group">
                    <label for="annual-amount">Annual Deposit Amount (₹)</label>
                    <input type="number" id="annual-amount" min="500" max="150000" step="50" value="150000" placeholder="Enter amount (multiple of 50, 500-150000)">
                </div>
                
                <div class="form-group hidden" id="monthly-investment-group">
                    <label for="monthly-amount">Monthly Deposit Amount (₹)</label>
                    <input type="number" id="monthly-amount" min="500" max="12500" step="50" value="12500" placeholder="Enter amount (multiple of 50, 500-12500)">
                </div>
                
                <div class="form-group hidden" id="monthly-timing-group">
                    <label for="monthly-timing">Monthly Deposit Timing</label>
                    <select id="monthly-timing">
                        <option value="before-5th">Before 5th of the month (Maximize Interest)</option>
                        <option value="after-5th">After 5th of the month</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="initial-years">Initial Investment Period (Years)</label>
                    <div class="range-container">
                        <div class="range-track">
                            <div class="range-fill" id="initial-years-fill" style="width: 100%;"></div>
                            <input type="range" class="custom-range" id="initial-years" min="1" max="15" value="15">
                        </div>
                        <span class="range-value" id="initial-years-value">15</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="interest-rate">Interest Rate (%)</label>
                    <input type="number" id="interest-rate" step="0.1" min="0" max="20" value="7.1" placeholder="Enter interest rate">
                </div>
                
                <div class="form-group">
                    <label for="extension-option">Extension Options</label>
                    <select id="extension-option">
                        <option value="no-extension">No Extension</option>
                        <option value="extension-with-investment">Extend with Further Investments</option>
                        <option value="extension-without-investment">Extend without Further Investments</option>
                    </select>
                </div>
                
                <div class="form-group hidden" id="extension-years-group">
                    <label for="extension-years">Extension Period (Years)</label>
                    <div class="range-container">
                        <div class="range-track">
                            <div class="range-fill" id="extension-years-fill" style="width: 50%;"></div>
                            <input type="range" class="custom-range" id="extension-years" min="5" max="20" value="5" step="5">
                        </div>
                        <span class="range-value" id="extension-years-value">5</span>
                    </div>
                </div>
                
                <div class="form-group hidden" id="extension-investment-group">
                    <label for="extension-amount">Extension Annual Investment (₹)</label>
                    <input type="number" id="extension-amount" min="0" max="150000" step="50" value="100000" placeholder="Enter amount (multiple of 50)">
                </div>
                
                <button id="calculate-btn">Calculate PPF Returns</button>
            </div>
            
            <div class="result-section">
                <h2 class="section-title">Projected Returns</h2>
                <div class="result-item">
                    <span class="result-label">Total Deposits:</span>
                    <span class="result-value total-deposit" id="total-deposit">₹ 0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Total Interest Earned:</span>
                    <span class="result-value total-interest" id="total-interest">₹ 0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Maturity Value:</span>
                    <span class="result-value maturity-value" id="maturity-value">₹ 0</span>
                </div>
                
                <div class="extension-section hidden" id="extension-results">
                    <h3>Extension Details</h3>
                    <div class="result-item">
                        <span class="result-label">Extension Deposits:</span>
                        <span class="result-value" id="extension-deposits">₹ 0</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Extension Interest:</span>
                        <span class="result-value total-interest" id="extension-interest">₹ 0</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Final Value:</span>
                        <span class="result-value maturity-value" id="final-value">₹ 0</span>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="ppf-chart"></canvas>
                    <div class="tooltip" id="chart-tooltip"></div>
                </div>
            </div>
        </div>
        
        <div class="rules-section">
            <h2 class="section-title">PPF Rules & Regulations</h2>
            <div class="rules-grid">
                <div class="rule-card">
                    <div class="rule-title">Deposit Limits</div>
                    <p>Minimum deposit: ₹500 per FY<br>
                    Maximum deposit: ₹1.5 lakh per FY<br>
                    Investments in multiples of ₹50<br>
                    Combined limit for self and minor accounts</p>
                </div>
                <div class="rule-card">
                    <div class="rule-title">Interest Calculation</div>
                    <p>Current rate: 7.1% p.a. (Q2 FY 2025-26)<br>
                    Interest calculated monthly on minimum balance between 5th and last day<br>
                    Credited annually on March 31</p>
                </div>
                <div class="rule-card">
                    <div class="rule-title">Extension Rules</div>
                    <p>15-year lock-in period<br>
                    Extendable in blocks of 5 years<br>
                    With or without further investments<br>
                    Partial withdrawals allowed after 7 years<br>
                    Loans available between 3rd and 6th year</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Note: This calculator provides estimates based on current PPF rules. Actual returns may vary based on government notifications.</p>
            <p>© 2025 Advanced PPF Calculator |  Developed by Anil Kumar V.T. | For educational purposes only</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get DOM elements
            const investmentTypeSelect = document.getElementById('investment-type');
            const annualInvestmentGroup = document.getElementById('annual-investment-group');
            const monthlyInvestmentGroup = document.getElementById('monthly-investment-group');
            const monthlyTimingGroup = document.getElementById('monthly-timing-group');
            const initialYearsSlider = document.getElementById('initial-years');
            const initialYearsFill = document.getElementById('initial-years-fill');
            const initialYearsValue = document.getElementById('initial-years-value');
            const extensionOptionSelect = document.getElementById('extension-option');
            const extensionYearsGroup = document.getElementById('extension-years-group');
            const extensionYearsSlider = document.getElementById('extension-years');
            const extensionYearsFill = document.getElementById('extension-years-fill');
            const extensionYearsValue = document.getElementById('extension-years-value');
            const extensionInvestmentGroup = document.getElementById('extension-investment-group');
            const calculateBtn = document.getElementById('calculate-btn');
            
            // Chart elements
            const ppfChartCanvas = document.getElementById('ppf-chart');
            const chartTooltip = document.getElementById('chart-tooltip');
            
            // Result elements
            const totalDepositEl = document.getElementById('total-deposit');
            const totalInterestEl = document.getElementById('total-interest');
            const maturityValueEl = document.getElementById('maturity-value');
            const extensionResults = document.getElementById('extension-results');
            const extensionDepositsEl = document.getElementById('extension-deposits');
            const extensionInterestEl = document.getElementById('extension-interest');
            const finalValueEl = document.getElementById('final-value');
            
            // Set canvas size to match container
            function resizeCanvas() {
                const container = ppfChartCanvas.parentElement;
                ppfChartCanvas.width = container.clientWidth;
                ppfChartCanvas.height = container.clientHeight;
            }
            
            // Initial resize
            resizeCanvas();
            
            // Update range fill for initial years
            function updateInitialYearsFill() {
                const value = initialYearsSlider.value;
                const min = initialYearsSlider.min;
                const max = initialYearsSlider.max;
                const percentage = ((value - min) / (max - min)) * 100;
                initialYearsFill.style.width = percentage + '%';
                initialYearsValue.textContent = value;
            }
            
            // Update range fill for extension years
            function updateExtensionYearsFill() {
                const value = extensionYearsSlider.value;
                const min = extensionYearsSlider.min;
                const max = extensionYearsSlider.max;
                const percentage = ((value - min) / (max - min)) * 100;
                extensionYearsFill.style.width = percentage + '%';
                extensionYearsValue.textContent = value;
            }
            
            // Event listeners
            investmentTypeSelect.addEventListener('change', toggleInvestmentType);
            initialYearsSlider.addEventListener('input', updateInitialYearsFill);
            extensionOptionSelect.addEventListener('change', toggleExtensionOptions);
            extensionYearsSlider.addEventListener('input', updateExtensionYearsFill);
            
            // Toggle investment type fields
            function toggleInvestmentType() {
                if (investmentTypeSelect.value === 'annual') {
                    annualInvestmentGroup.classList.remove('hidden');
                    monthlyInvestmentGroup.classList.add('hidden');
                    monthlyTimingGroup.classList.add('hidden');
                } else {
                    annualInvestmentGroup.classList.add('hidden');
                    monthlyInvestmentGroup.classList.remove('hidden');
                    monthlyTimingGroup.classList.remove('hidden');
                }
            }
            
            // Toggle extension options
            function toggleExtensionOptions() {
                if (extensionOptionSelect.value === 'no-extension') {
                    extensionYearsGroup.classList.add('hidden');
                    extensionInvestmentGroup.classList.add('hidden');
                    extensionResults.classList.add('hidden');
                } else {
                    extensionYearsGroup.classList.remove('hidden');
                    if (extensionOptionSelect.value === 'extension-with-investment') {
                        extensionInvestmentGroup.classList.remove('hidden');
                    } else {
                        extensionInvestmentGroup.classList.add('hidden');
                    }
                    extensionResults.classList.remove('hidden');
                }
            }
            
            // Calculate PPF returns
            function calculatePPF() {
                // Get input values
                const investmentType = investmentTypeSelect.value;
                const annualAmount = parseFloat(document.getElementById('annual-amount').value) || 0;
                const monthlyAmount = parseFloat(document.getElementById('monthly-amount').value) || 0;
                const monthlyTiming = document.getElementById('monthly-timing').value;
                const initialYears = parseInt(initialYearsSlider.value) || 15;
                const interestRate = parseFloat(document.getElementById('interest-rate').value) || 7.1;
                const extensionOption = extensionOptionSelect.value;
                const extensionYears = parseInt(extensionYearsSlider.value) || 5;
                const extensionAmount = parseFloat(document.getElementById('extension-amount').value) || 0;
                
                // Validate inputs
                if (investmentType === 'annual') {
                    if (annualAmount < 500 || annualAmount > 150000) {
                        alert("Please enter a valid annual deposit amount between ₹500 and ₹1,50,000");
                        return;
                    }
                    if (annualAmount % 50 !== 0) {
                        alert("Annual deposit amount must be a multiple of ₹50");
                        return;
                    }
                }
                
                if (investmentType === 'monthly') {
                    if (monthlyAmount < 500 || monthlyAmount > 12500) {
                        alert("Please enter a valid monthly deposit amount between ₹500 and ₹12,500");
                        return;
                    }
                    if (monthlyAmount % 50 !== 0) {
                        alert("Monthly deposit amount must be a multiple of ₹50");
                        return;
                    }
                }
                
                if (extensionOption === 'extension-with-investment' && extensionAmount > 0) {
                    if (extensionAmount % 50 !== 0) {
                        alert("Extension deposit amount must be a multiple of ₹50");
                        return;
                    }
                }
                
                // Calculate initial PPF returns
                let maturityValue = 0;
                let totalDeposits = 0;
                const yearlyData = [];
                
                // Calculate for initial period
                for (let year = 1; year <= initialYears; year++) {
                    if (investmentType === 'annual') {
                        // For annual investment, deposit at the beginning of the year for maximum interest
                        maturityValue += annualAmount;
                        totalDeposits += annualAmount;
                    } else {
                        // Monthly investments
                        for (let month = 1; month <= 12; month++) {
                            if (monthlyTiming === 'before-5th') {
                                // Deposit at the beginning of the month
                                maturityValue += monthlyAmount;
                                totalDeposits += monthlyAmount;
                            }
                            
                            // Apply monthly interest (simple approximation)
                            maturityValue = maturityValue * (1 + interestRate / 100 / 12);
                            
                            if (monthlyTiming === 'after-5th') {
                                // Deposit at the end of the month
                                maturityValue += monthlyAmount;
                                totalDeposits += monthlyAmount;
                            }
                        }
                    }
                    
                    // Apply annual compounding at the end of each year
                    if (investmentType === 'annual') {
                        maturityValue = maturityValue * (1 + interestRate / 100);
                    }
                    
                    yearlyData.push({
                        year: year,
                        value: maturityValue
                    });
                }
                
                // Calculate extension if applicable
                let extensionDeposits = 0;
                let extensionInterest = 0;
                let finalValue = maturityValue;
                
                if (extensionOption !== 'no-extension') {
                    const initialValue = maturityValue;
                    
                    for (let year = 1; year <= extensionYears; year++) {
                        if (extensionOption === 'extension-with-investment') {
                            finalValue += extensionAmount;
                            extensionDeposits += extensionAmount;
                        }
                        
                        // Apply annual interest
                        finalValue = finalValue * (1 + interestRate / 100);
                        
                        yearlyData.push({
                            year: initialYears + year,
                            value: finalValue
                        });
                    }
                    
                    extensionInterest = finalValue - initialValue - extensionDeposits;
                }
                
                const totalInterest = maturityValue - totalDeposits;
                
                // Update results (rounded to nearest rupee)
                totalDepositEl.textContent = `₹ ${formatNumber(Math.round(totalDeposits))}`;
                totalInterestEl.textContent = `₹ ${formatNumber(Math.round(totalInterest))}`;
                maturityValueEl.textContent = `₹ ${formatNumber(Math.round(maturityValue))}`;
                
                if (extensionOption !== 'no-extension') {
                    extensionDepositsEl.textContent = `₹ ${formatNumber(Math.round(extensionDeposits))}`;
                    extensionInterestEl.textContent = `₹ ${formatNumber(Math.round(extensionInterest))}`;
                    finalValueEl.textContent = `₹ ${formatNumber(Math.round(finalValue))}`;
                }
                
                // Resize canvas and draw chart
                resizeCanvas();
                drawChart(yearlyData);
            }
            
            // Format number with commas (no decimals)
            function formatNumber(num) {
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
            
            // Draw chart
            function drawChart(data) {
                const ctx = ppfChartCanvas.getContext('2d');
                ctx.clearRect(0, 0, ppfChartCanvas.width, ppfChartCanvas.height);
                
                if (data.length === 0) return;
                
                // Chart dimensions with proper padding
                const width = ppfChartCanvas.width;
                const height = ppfChartCanvas.height;
                const paddingLeft = 80; // Increased left padding for Y-axis labels
                const paddingRight = 30;
                const paddingTop = 30;
                const paddingBottom = 50;
                const chartWidth = width - paddingLeft - paddingRight;
                const chartHeight = height - paddingTop - paddingBottom;
                
                // Find max and min values for scaling
                const values = data.map(d => d.value);
                const maxValue = Math.max(...values);
                const minValue = Math.min(...values);
                
                // Add some padding to the scale for better visualization
                const valueRange = maxValue - minValue;
                const scalePadding = valueRange * 0.1;
                const chartMaxValue = maxValue + scalePadding;
                const chartMinValue = Math.max(0, minValue - scalePadding);
                
                // Draw grid lines and labels
                ctx.strokeStyle = '#e0e0e0';
                ctx.lineWidth = 1;
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                
                // Vertical grid lines and X-axis labels
                const xStep = chartWidth / (data.length - 1);
                for (let i = 0; i < data.length; i++) {
                    const x = paddingLeft + i * xStep;
                    
                    // Grid line
                    ctx.beginPath();
                    ctx.moveTo(x, paddingTop);
                    ctx.lineTo(x, height - paddingBottom);
                    ctx.stroke();
                    
                    // X-axis label (show every 2-3 years for clarity)
                    if (i % Math.ceil(data.length / 5) === 0 || i === data.length - 1) {
                        ctx.fillText(`Year ${data[i].year}`, x, height - paddingBottom + 20);
                    }
                }
                
                // Horizontal grid lines and Y-axis labels
                const ySteps = 5;
                const yStep = chartHeight / ySteps;
                
                for (let i = 0; i <= ySteps; i++) {
                    const y = height - paddingBottom - i * yStep;
                    
                    // Grid line
                    ctx.beginPath();
                    ctx.moveTo(paddingLeft, y);
                    ctx.lineTo(width - paddingRight, y);
                    ctx.stroke();
                    
                    // Y-axis label
                    const value = chartMinValue + (chartMaxValue - chartMinValue) * (i / ySteps);
                    ctx.textAlign = 'right';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(`₹${formatNumber(Math.round(value))}`, paddingLeft - 10, y);
                }
                
                // Draw axes
                ctx.beginPath();
                ctx.moveTo(paddingLeft, paddingTop);
                ctx.lineTo(paddingLeft, height - paddingBottom);
                ctx.lineTo(width - paddingRight, height - paddingBottom);
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Draw line chart
                ctx.beginPath();
                const xScale = chartWidth / (data.length - 1);
                const yScale = chartHeight / (chartMaxValue - chartMinValue);
                
                // Store chart points for tooltip
                const chartPoints = [];
                
                for (let i = 0; i < data.length; i++) {
                    const x = paddingLeft + i * xScale;
                    const y = height - paddingBottom - ((data[i].value - chartMinValue) * yScale);
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                    
                    // Store point for tooltip
                    chartPoints.push({
                        x: x,
                        y: y,
                        year: data[i].year,
                        value: Math.round(data[i].value)
                    });
                }
                
                // Draw line with gradient
                const gradient = ctx.createLinearGradient(0, 0, width, 0);
                gradient.addColorStop(0, '#4d7cff');
                gradient.addColorStop(0.5, '#FF9800');
                gradient.addColorStop(1, '#4CAF50');
                
                ctx.strokeStyle = gradient;
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // Draw points
                for (let i = 0; i < chartPoints.length; i++) {
                    const point = chartPoints[i];
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);
                    ctx.fillStyle = '#4d7cff';
                    ctx.fill();
                    ctx.strokeStyle = '#fff';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
                
                // Add mouse event listeners for tooltip
                ppfChartCanvas.addEventListener('mousemove', function(event) {
                    const rect = ppfChartCanvas.getBoundingClientRect();
                    const x = event.clientX - rect.left;
                    const y = event.clientY - rect.top;
                    
                    // Find closest point
                    let closestPoint = null;
                    let minDistance = Infinity;
                    
                    for (let i = 0; i < chartPoints.length; i++) {
                        const point = chartPoints[i];
                        const distance = Math.sqrt(Math.pow(x - point.x, 2) + Math.pow(y - point.y, 2));
                        if (distance < minDistance) {
                            minDistance = distance;
                            closestPoint = point;
                        }
                    }
                    
                    // Show tooltip if close enough to a point
                    if (closestPoint && minDistance < 20) {
                        chartTooltip.style.opacity = 1;
                        chartTooltip.style.left = (closestPoint.x + 10) + 'px';
                        chartTooltip.style.top = (closestPoint.y - 30) + 'px';
                        chartTooltip.innerHTML = `Year: ${closestPoint.year}<br>Value: ₹${formatNumber(closestPoint.value)}`;
                    } else {
                        chartTooltip.style.opacity = 0;
                    }
                });
                
                ppfChartCanvas.addEventListener('mouseout', function() {
                    chartTooltip.style.opacity = 0;
                });
            }
            
            // Event listeners
            calculateBtn.addEventListener('click', calculatePPF);
            window.addEventListener('resize', function() {
                resizeCanvas();
                calculatePPF();
            });
            
            // Initialize
            toggleInvestmentType();
            toggleExtensionOptions();
            updateInitialYearsFill();
            updateExtensionYearsFill();
            
            // Initialize calculation
            calculatePPF();
        });
    </script>
</body>
</html>
